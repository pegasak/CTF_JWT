# CTF Challenge: Weak JWT Signature Exploit

Это приложение демонстрирует уязвимость, связанную с использованием слабой подписи в JWT (JSON Web Tokens). Участникам CTF нужно получить доступ к защищённому ресурсу, используя уязвимость в механизме подписи JWT токенов.

## Описание уязвимости

Уязвимость возникает из-за использования слабого секретного ключа для подписи JWT токенов. Если злоумышленник сможет подобрать или угадать секретный ключ, он сможет сгенерировать поддельный токен с ролью `admin` и получить доступ к защищённому ресурсу.

### Почему это происходит?
- Приложение использует слабый секретный ключ для подписи JWT токенов.
- Злоумышленник может легко подобрать ключ методом brute force.
- Если ключ подобран, можно сгенерировать токен с любой ролью, включая `admin`.

## Способы защиты

1. **Использование сложного секретного ключа**: Убедитесь, что секретный ключ достаточно сложный и не может быть легко подобран.
2. **Использование асимметричной подписи**: Вместо HMAC с симметричным ключом используйте RSA или ECDSA с асимметричными ключами.
3. **Регулярная смена ключей**: Периодически меняйте секретный ключ, чтобы минимизировать риск его компрометации.
4. **Ограничение времени жизни токена**: Уменьшите время жизни токена, чтобы минимизировать риск его компрометации.
## Как запустить приложение

### Требования
- Docker
- Docker Compose

### Шаги для запуска

1. Клонируйте репозиторий:
   ```bash
   git clone hgit@github.com:pegasak/CTF_JWT.git
2. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up --build
3. Приложение будет доступно по адресу: `http://localhost:5000`

### PoC-эксплоит для получения флага

1. Зарегистрируйтесь как обычный пользователь через `/register`.
2. Авторизуйтесь через `/login` и получите ваши access и refresh токены.
3. Взломайте токен, чтобы получить `Secret Key`:
   1) Скачайте Hashcat Binaries с официального сайта: `https://hashcat.net/hashcat/`
   2) Распакуйте ZIP-архив в удобную папку
   3) Откройте CMD и перейдите в папку hashcat-6.2.6
   4) Проверьте работает ли Hashcat:
      ```bash
      hashcat.exe --help
   5) Далее нам нужно посмотреть, каким алгоритмом шифруется JWT. Для этого напишите программу, которая разбирает заголовок или воспользуйтесь моей в файле `brute_force.py`
   6) В проекте есть файл `rockyou.txt`, который содержит самые популярные пароли. Сохраните его в ту же папку, что и Hashcat. В CMD введите команду:
      ``` bash
      hashcat -m 16500 <ваш jwt токен> rockyou.txt
   7) Далее введите:
      ``` bash
      hashcat -m 16500 <ваш jwt токен> rockyou.txt --show
   8) Посмотрев пароль сгенерируйте новый JWT токен с ролью админ, новым именем и jti. Программа для генерации токенов находится в `configure_jwt.py`.
4. Сгенерировав новый токен откройте приложение и перейдите на эндпоинт `/protected`, введите ваш новый JWT токен и нажмите `Submit`.
5. Вы получили доступ к защищённому ресурсу и видите таблицу всех пользователей с их данными.